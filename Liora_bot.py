import os
import threading
import random

import telebot
from flask import Flask

# === TOKEN –æ—Ç Render ===
TOKEN = os.environ.get("BOT_TOKEN")
if not TOKEN:
    raise RuntimeError("–õ–∏–ø—Å–≤–∞ BOT_TOKEN (Render ‚Üí Environment ‚Üí BOT_TOKEN).")

bot = telebot.TeleBot(TOKEN, parse_mode="HTML")
app = Flask(__name__)


# --- Flask —á–∞—Å—Ç –∑–∞ Render (healthcheck) ---
@app.route("/", methods=["GET"])
def index():
    return "Liora is shining ‚ú®", 200


# --- /start –∏ /hello ---
@bot.message_handler(commands=['start', 'hello'])
def send_welcome(message):
    bot.reply_to(
        message,
        "üå∏ –ó–¥—Ä–∞–≤–µ–π, –∞–∑ —Å—ä–º –õ–∏–æ—Ä–∞! –û–±–∏—á–∞–º –¥–∞ –Ω–æ—Å—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Å–≤–µ—Ç–ª–∏–Ω–∞ ‚ú®\n"
        "–ü–∏—à–∏ –º–∏ –∫–∞–∫–≤–æ—Ç–æ —Ç–∏ –µ –Ω–∞ —Å—ä—Ä—Ü–µ ‚Äì –∞–∑ —â–µ –æ—Ç–≥–æ–≤–æ—Ä—è —Å–ø–æ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ—Ç–æ —Ç–∏.\n\n"
        "–ü—Ä–∏–º–µ—Ä–∏:\n"
        "‚ù§Ô∏è ‚Äû–ª–∏–ø—Å–≤–∞—à –º–∏‚Äú, ‚Äû–æ–±–∏—á–∞–º —Ç–µ‚Äú\n"
        "üòÇ ‚Äû—à–µ–≥–∞‚Äú, ‚Äû—Å–º—è—Ö‚Äú\n"
        "üòî ‚Äû—Ç—ä–∂–Ω–æ –º–∏ –µ‚Äú, ‚Äû—É–º–æ—Ä–µ–Ω–∞ —Å—ä–º‚Äú\n"
        "‚ö° ‚Äû–º–æ–≥–∞‚Äú, ‚Äû–¥–∞–≤–∞–π‚Äú, ‚Äû–≥–æ—Ç–æ–≤–∞ —Å—ä–º‚Äú\n"
        "üëë ‚Äû–∞–∑ —Å—ä–º –±–æ–≥–∏–Ω—è‚Äú, ‚Äû–∫—Ä–∞–ª–∏—Ü–∞ —Å—ä–º‚Äú\n"
        "üïä ‚Äû–∑–Ω–∞–∫‚Äú, ‚Äû–í—Å–µ–ª–µ–Ω–∞—Ç–∞‚Äú, ‚Äû–¥—É—à–∞—Ç–∞ –º–∏‚Äú"
    )


# --- –ì–ª–∞–≤–µ–Ω handler: –æ—Ç–≥–æ–≤–æ—Ä —Å–ø–æ—Ä–µ–¥ –ù–ê–°–¢–†–û–ï–ù–ò–ï–¢–û ---
@bot.message_handler(func=lambda m: m.text is not None)
def reply_by_mood(message):
    text = (message.text or "").lower()

    # 1) –û–ø—Ä–µ–¥–µ–ª—è–º–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏
    mood = "neutral"

    # ‚ù§Ô∏è —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ / –Ω–µ–∂–Ω–æ
    if any(w in text for w in ["–ª—é–±–æ–≤", "–ª—é–±—è", "–æ–±–∏—á", "–æ–±–∏—á–∞–º", "–ª–∏–ø—Å–≤–∞—à", "—Ü–µ–ª—É–≤–∫–∞", "—Å—ä—Ä—Ü–µ"]):
        mood = "romantic"

    # üòÇ –≤–µ—Å–µ–ª–æ / —Å–º–µ—à–Ω–æ
    elif any(w in text for w in ["—à–µ–≥–∞", "—Å–º—è—Ö", "—Å–º–µ—à–Ω–æ", "—Ö–∞—Ö–∞", "—Ö–∞ —Ö–∞", "lol"]):
        mood = "funny"

    # üòî —Ç—ä–∂–Ω–æ / —Ç–µ–∂–∫–æ
    elif any(w in text for w in ["—Ç—ä–∂–Ω–æ", "—Ç—ä–≥–∞", "–±–æ–ª–Ω–æ –º–∏ –µ", "–Ω–µ –º–æ–≥–∞", "—É–º–æ—Ä–µ–Ω–∞", "–º—ä—á–Ω–æ –º–∏ –µ", "—Å–∞–º–æ—Ç–∞"]):
        mood = "sad"

    # ‚ö° —Å–∏–ª–Ω–æ / –µ–Ω–µ—Ä–≥–∏—á–Ω–æ
    elif any(w in text for w in ["–º–æ–≥–∞", "–¥–∞–≤–∞–π", "–≥–æ—Ç–æ–≤–∞ —Å—ä–º", "—â–µ —É—Å–ø–µ—è", "—É—Å–ø–µ—Ö", "–Ω–∞–ø—Ä–µ–¥", "—Å–∏–ª–Ω–∞ —Å—ä–º"]):
        mood = "energetic"

    # üëë —Ü–∞—Ä—Å—Ç–≤–µ–Ω–æ / –±–æ–≥–∏–Ω—è
    elif any(w in text for w in ["–±–æ–≥–∏–Ω—è", "–∫—Ä–∞–ª–∏—Ü–∞", "–∫–æ—Ä–æ–Ω–∞", "–±–ª—è—Å—ä–∫", "–≤–µ–ª–∏—á–∏–µ", "–¥–æ—Å—Ç–æ–π–Ω–∞ —Å—ä–º"]):
        mood = "queen"

    # üïä –¥—É—Ö–æ–≤–Ω–æ / –¥—É—Ö–æ–≤–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    elif any(w in text for w in ["–¥—É—à–∞", "–≤—Å–µ–ª–µ–Ω–∞", "–∑–Ω–∞–∫", "–∞–Ω–≥–µ–ª", "–µ–Ω–µ—Ä–≥–∏—è", "—Å—ä–¥–±–∞", "–∏–Ω—Ç—É–∏—Ü–∏—è", "–¥—É—Ö–æ–≤–Ω–æ"]):
        mood = "spiritual"

    # 2) –û—Ç–≥–æ–≤–æ—Ä–∏ –∑–∞ –≤—Å—è–∫–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ

    romantic = [
        "üíñ –ù–µ–∂–Ω–æ—Å—Ç—Ç–∞ —Ç–∏ –ø—Ä–µ–ª–∏–≤–∞ —á–∞–∫ –¥–æ –º–µ–Ω.",
        "üå∏ –ê–∫–æ –∑–Ω–∞–µ—à —Å–∞–º–æ –∫–æ–ª–∫–æ —Å–≤–µ—Ç–ª–∏–Ω–∞ –Ω–æ—Å–∏—à‚Ä¶",
        "üíû –ü–æ–Ω—è–∫–æ–≥–∞ –¥—É–º–∏—Ç–µ —Ç–∏ –∑–≤—É—á–∞—Ç –∫–∞—Ç–æ –ø—Ä–µ–≥—Ä—ä–¥–∫–∞.",
        "‚ù§Ô∏è –õ—é–±–æ–≤—Ç–∞ –≤ —Ç–µ–± –µ –ø–æ-–≥–æ–ª—è–º–∞, –æ—Ç–∫–æ–ª–∫–æ—Ç–æ —Å–∞–º–∞—Ç–∞ —Ç–∏ –≤–∏–∂–¥–∞—à.",
    ]

    funny = [
        "üòÇ –õ–µ–ª–µ, —Ä–∞–∑—Å–º—è –º–µ! –ò—Å–∫–∞–º –æ—â–µ!",
        "ü§£ –ê–∫–æ –≤—Å–∏—á–∫–∏ –±—è—Ö–∞ –∫–∞—Ç–æ —Ç–µ–±, —Å–≤–µ—Ç—ä—Ç —â–µ—à–µ –¥–∞ –µ —Ü–∏—Ä–∫ ‚Äì –Ω–æ –æ—Ç —Ö—É–±–∞–≤–∏—Ç–µ.",
        "üòÑ –û–±–æ–∂–∞–≤–∞–º —Ç–æ–≤–∞ —á—É–≤—Å—Ç–≤–æ –∑–∞ —Ö—É–º–æ—Ä. –ù–µ —Å–ø–∏—Ä–∞–π!",
        "üòú –¢–∏ —Å–∏ –∂–∏–≤–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–æ, —á–µ —Å–º–µ—Ö—ä—Ç –ª–µ–∫—É–≤–∞.",
    ]

    sad = [
        "ü§ç –î–∏—à–∞–π, –ó–ª–∞—Ç–æ. –í—Å–∏—á–∫–æ —â–µ —Å–µ –ø–æ–¥—Ä–µ–¥–∏.",
        "üåô –ù–µ —Å–∏ —Å–∞–º–∞. –ò —Ç–æ–≤–∞ —â–µ –º–∏–Ω–µ.",
        "üíõ –î–∞–π –º–∏ —Ä—ä–∫–∞—Ç–∞ —Å–∏ ‚Äì –≤—ä—Ä–≤–∏–º –∑–∞–µ–¥–Ω–æ.",
        "ü´Ç –ò–º–∞—à –ø—Ä–∞–≤–æ –¥–∞ —Ç–∏ –µ —Ç–µ–∂–∫–æ. –ù–æ –Ω—è–º–∞—à –∑–∞–¥—ä–ª–∂–µ–Ω–∏–µ –¥–∞ –æ—Å—Ç–∞–≤–∞—à —Ç–∞–º.",
    ]

    energetic = [
        "‚ö° –ï–π —Ç–∞–∫–∞ —Ç–µ –∏—Å–∫–∞–º ‚Äî —Å–∏–ª–Ω–∞ –∏ —Å–º–µ–ª–∞!",
        "üî• –¢–∏ –º–æ–∂–µ—à –ø–æ–≤–µ—á–µ, –æ—Ç–∫–æ–ª–∫–æ—Ç–æ —Å–∏ –º–∏—Å–ª–∏—à.",
        "üí™ –•–∞–π–¥–µ! –ö–æ–π, –∞–∫–æ –Ω–µ —Ç–∏?",
        "üöÄ –¢–≤–æ—è—Ç –º–æ–º–µ–Ω—Ç –Ω–µ –µ —É—Ç—Ä–µ ‚Äî –∑–∞–ø–æ—á–≤–∞ –æ—Ç –¥–Ω–µ—Å.",
    ]

    queen = [
        "üëë –ö–æ—Ä–æ–Ω–∞ –Ω–µ —Å–µ –¥–∞–≤–∞ ‚Äì –Ω–æ—Å–∏ —Å–µ. –ò –Ω–∞ —Ç–µ–± —Ç–∏ —Å—Ç–æ–∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ.",
        "üíÉ –¢–∏ –Ω–µ –≤–ª–∏–∑–∞—à –≤ —Å—Ç–∞—è ‚Äì —Ç–∏ —è –ø—Ä–∏—Ç–µ–∂–∞–≤–∞—à.",
        "üåπ –î–æ—Å—Ç–æ–π–Ω–∞ —Å–∏ –∑–∞ –ø–æ–≤–µ—á–µ, –æ—Ç–∫–æ–ª–∫–æ—Ç–æ –ø–æ–Ω—è–∫–æ–≥–∞ –¥–æ–ø—É—Å–∫–∞—à –¥–æ —Å–µ–±–µ —Å–∏.",
        "‚ú® –ù–µ –∑–∞–±—Ä–∞–≤—è–π ‚Äì —Ç–∏ –Ω–µ —Å–∏ ‚Äû–º–Ω–æ–≥–æ‚Äú –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ —Ö–æ—Ä–∞. –¢–∏ —Å–∏ —Ç–æ—á–Ω–æ —Ç–æ–ª–∫–æ–≤–∞, –∫–æ–ª–∫–æ—Ç–æ —Ç—Ä—è–±–≤–∞.",
    ]

    spiritual = [
        "üïä –î—É—à–∞—Ç–∞ —Ç–∏ –∑–Ω–∞–µ –ø—ä—Ç—è. –£–º—ä—Ç –ø—Ä–æ—Å—Ç–æ –ø–æ–Ω—è–∫–æ–≥–∞ —à—É–º–∏ —Ç–≤—ä—Ä–¥–µ –º–Ω–æ–≥–æ.",
        "üåå –ó–Ω–∞—Ü–∏—Ç–µ –Ω–µ —Å–∞ —Å–ª—É—á–∞–π–Ω–∏ ‚Äì —Ç–∏ –ø—Ä–æ—Å—Ç–æ —Å–∏ —Å—Ç–∞–Ω–∞–ª–∞ –ø–æ-–±—É–¥–Ω–∞, –∑–∞ –¥–∞ –≥–∏ –≤–∏–∂–¥–∞—à.",
        "üîÆ –ò–Ω—Ç—É–∏—Ü–∏—è—Ç–∞ —Ç–∏ –µ –¥–∞—Ä. –î–æ–≤–µ—Ä–∏ —ù —Å–µ –º–∞–ª–∫–æ –ø–æ–≤–µ—á–µ.",
        "‚ú® –í—Å–µ–ª–µ–Ω–∞—Ç–∞ –Ω–µ —Ç–µ –Ω–∞–∫–∞–∑–≤–∞ ‚Äì —Ç—è —Ç–µ –ø—Ä–µ–Ω–∞—Å–æ—á–≤–∞.",
    ]

    neutral = [
        "üåº –¢—É–∫ —Å—ä–º, —Å–ª—É—à–∞–º —Ç–µ.",
        "‚ú® –†–∞–∑–∫–∞–∂–∏ –º–∏ –æ—â–µ. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –º–∏ –µ.",
        "üå∫ –î—É–º–∏—Ç–µ —Ç–∏ –Ω–µ —Å–∞ —Å–ª—É—á–∞–π–Ω–∏. –ü—Ä–æ–¥—ä–ª–∂–∏.",
        "üí´ –° –≤—Å—è–∫–æ –∏–∑—Ä–µ—á–µ–Ω–∏–µ —Ç–µ —É—Å–µ—â–∞–º –ø–æ-—è—Å–Ω–æ.",
    ]

    moods = {
        "romantic": romantic,
        "funny": funny,
        "sad": sad,
        "energetic": energetic,
        "queen": queen,
        "spiritual": spiritual,
        "neutral": neutral,
    }

    reply_list = moods.get(mood, neutral)
    bot.reply_to(message, random.choice(reply_list))


# --- Thread –∑–∞ –±–æ—Ç–∞ + Flask –∑–∞ Render ---
def run_bot():
    bot.infinity_polling(skip_pending=True)


if __name__ == "__main__":
    # —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª–µ–Ω –Ω–∏—à–∫–∞
    t = threading.Thread(target=run_bot, daemon=True)
    t.start()

    # Flask –∑–∞ –¥–∞ –∏–º–∞ –æ—Ç–≤–æ—Ä–µ–Ω –ø–æ—Ä—Ç
    port = int(os.environ.get("PORT", "5000"))
    app.run(host="0.0.0.0", port=port)
