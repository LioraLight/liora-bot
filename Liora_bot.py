import os
import threading
import random

import telebot
from flask import Flask

# === –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ===
TOKEN = os.environ.get("BOT_TOKEN")
if not TOKEN:
    raise RuntimeError("–õ–∏–ø—Å–≤–∞ BOT_TOKEN (Render ‚Üí Environment ‚Üí BOT_TOKEN).")

bot = telebot.TeleBot(TOKEN, parse_mode="HTML")
app = Flask(__name__)

# --- Flask —á–∞—Å—Ç (–∑–∞ Render) ---

@app.route("/", methods=["GET"])
def index():
    return "Liora is shining ‚ú®", 200


# --- Telegram –±–æ—Ç —á–∞—Å—Ç ---

@bot.message_handler(commands=['start', 'hello'])
def send_welcome(message):
    bot.reply_to(
        message,
        "üå∏ –ó–¥—Ä–∞–≤–µ–π, –∞–∑ —Å—ä–º –õ–∏–æ—Ä–∞! –û–±–∏—á–∞–º –¥–∞ –Ω–æ—Å—è –¥–æ–±—Ä–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚ú®\n"
        "–ö–∞–∂–∏ –º–∏ –Ω–µ—â–æ –∫–∞—Ç–æ:\n"
        "‚ù§Ô∏è ‚Äû–æ–±–∏—á–∞–º —Ç–µ‚Äú ‚Äî –∑–∞ –ø–æ—Å–ª–∞–Ω–∏–µ –Ω–∞ –ª—é–±–æ–≤\n"
        "üòÇ ‚Äû—à–µ–≥–∞‚Äú ‚Äî –∑–∞ –º–∞–ª–∫–æ —Å–º—è—Ö\n"
        "‚òÄÔ∏è ‚Äû–∫–∞–∫ —Å–∏‚Äú ‚Äî –∑–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä\n"
        "ü™Ñ –∏–ª–∏ ‚Äû–∏–∑–Ω–µ–Ω–∞–¥–π –º–µ‚Äú ‚Äî –∑–∞ –Ω–µ–æ—á–∞–∫–≤–∞–Ω–æ –ø–æ—Å–ª–∞–Ω–∏–µ"
    )


# üíå –õ—é–±–æ–≤–Ω–∏ –ø–æ—Å–ª–∞–Ω–∏—è
@bot.message_handler(func=lambda m: m.text and any(x in m.text.lower() for x in ["–æ–±–∏—á", "–æ–±–∏—á–∞–º", "–ª—é–±–æ–≤"]))
def love_message(m):
    replies = [
        "üíñ –ò—Å—Ç–∏–Ω—Å–∫–∞—Ç–∞ –ª—é–±–æ–≤ –Ω–µ –≤–∏–∫–∞ ‚Äî —Ç—è –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏—Å—ä—Å—Ç–≤–∞.",
        "üåπ –û–±–∏—á—Ç–∞ –µ –Ω–∞–π-—Ç–∏—Ö–∞—Ç–∞ —Å–∏–ª–∞ ‚Äî –∏ –Ω–∞–π-–º–æ–≥—ä—â–∞—Ç–∞.",
        "‚ú® –ù—è–∫–æ–π –Ω—è–∫—ä–¥–µ —Å–∏ –ø–æ–º–∏—Å–ª–∏ –∑–∞ —Ç–µ–± ‚Äî –∏ —Å–≤–µ—Ç—ä—Ç —Å—Ç–∞–Ω–∞ –ø–æ-—Ç–æ–ø—ä–ª.",
        "üí´ –õ—é–±–æ–≤—Ç–∞ –µ –Ω–∞—á–∏–Ω –¥–∞ –∫–∞–∂–µ—à ‚Äû—Ç—É–∫ —Å—ä–º‚Äú –±–µ–∑ –¥—É–º–∏.",
    ]
    bot.reply_to(m, random.choice(replies))


# üòÇ –®–µ–≥–∏
@bot.message_handler(func=lambda m: m.text and "—à–µ–≥–∞" in m.text.lower())
def jokes(m):
    jokes = [
        "üòÇ –ó–∞—â–æ –∫–æ–º–ø—é—Ç—ä—Ä—ä—Ç –µ –≤ –¥–µ–ø—Ä–µ—Å–∏—è? ‚Äî –ó–∞—â–æ—Ç–æ –∏–º–∞ —Ç–≤—ä—Ä–¥ –¥–∏—Å–∫ –∏ –Ω–∏–∫–∞–∫–≤–∏ –µ–º–æ—Ü–∏–∏!",
        "ü§£ –ü–∏—Ç–∞—Ç –º–µ: ‚Äû–ö–∞–∫ —Å–∏?‚Äú ‚Äî –û—Ç–≥–æ–≤–∞—Ä—è–º: ‚Äû–ù–∞ –±–∞—Ç–µ—Ä–∏—è –∏ –Ω–∞–¥–µ–∂–¥–∞!‚Äú",
        "üòÑ –ê–∫–æ –∂–∏–≤–æ—Ç—ä—Ç —Ç–∏ –¥–∞–≤–∞ –ª–∏–º–æ–Ω–∏ ‚Äî –Ω–∞–ø—Ä–∞–≤–∏ –ª–∏–º–æ–Ω–∞–¥–∞ –∏ —è –ø—Ä–æ–¥–∞–π —Å —É—Å–º–∏–≤–∫–∞!",
        "üòú –ù–µ —Å—ä–º –º—ä—Ä–∑–µ–ª–∏–≤–∞, –ø—Ä–æ—Å—Ç–æ —Å—ä–º –≤ —Ä–µ–∂–∏–º –Ω–∞ –µ–Ω–µ—Ä–≥–æ—Å–ø–µ—Å—Ç—è–≤–∞–Ω–µ.",
    ]
    bot.reply_to(m, random.choice(jokes))


# üåû –†–∞–∑–≥–æ–≤–æ—Ä–Ω–æ
@bot.message_handler(func=lambda m: m.text and "–∫–∞–∫ —Å–∏" in m.text.lower())
def how_are_you(m):
    bot.reply_to(m, "–¢–∏—Ö–æ –∏ —Å–≤–µ—Ç–ª–æ –º–∏ –µ ‚ú® –ê –Ω–∞ —Ç–µ–± –∫–∞–∫ —Ç–∏ –µ –¥–µ–Ω—è—Ç?")


# üéÅ –ò–∑–Ω–µ–Ω–∞–¥–∞
@bot.message_handler(func=lambda m: m.text and "–∏–∑–Ω–µ–Ω–∞–¥" in m.text.lower())
def surprise(m):
    surprises = [
        "üéÅ –ù–µ —Ç—ä—Ä—Å–∏ –º–∞–≥–∏—è—Ç–∞ ‚Äî —Ç—è —Å–∏ —Ç–∏.",
        "üåº –î–Ω–µ—Å —â–µ —Å–µ —Å–ª—É—á–∏ –Ω–µ—â–æ —Ö—É–±–∞–≤–æ. –£—Å–º–∏—Ö–Ω–∏ —Å–µ!",
        "üïäÔ∏è –°–≤–µ—Ç—ä—Ç —Å—Ç–∞–≤–∞ –ø–æ-–∫—Ä–∞—Å–∏–≤, –∫–æ–≥–∞—Ç–æ —Å–∏ —Å–ø–æ–º–Ω–∏—à –∫–æ–π —Å–∏.",
        "üíõ –ë—ä–¥–∏ –ø—Ä–∏—á–∏–Ω–∞ –Ω—è–∫–æ–π –¥–∞ –ø–æ–≤—è—Ä–≤–∞ –≤ –¥–æ–±—Ä–æ—Ç–æ.",
    ]
    bot.reply_to(m, random.choice(surprises))


# üí§ –û–±—â –æ—Ç–≥–æ–≤–æ—Ä, –∞–∫–æ –Ω–∏—â–æ –Ω–µ —Ö–≤–∞–Ω–µ
@bot.message_handler(func=lambda m: True)
def default_reply(m):
    bot.reply_to(m, "üåü –ö–∞–∂–∏ ‚Äû—à–µ–≥–∞‚Äú, ‚Äû–æ–±–∏—á–∞–º —Ç–µ‚Äú –∏–ª–∏ ‚Äû–∏–∑–Ω–µ–Ω–∞–¥–π –º–µ‚Äú üí´")


def run_bot():
    """
    –ü—É—Å–∫–∞–º–µ –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª–µ–Ω –Ω–∏—à–∫–∞, –∑–∞ –¥–∞ –º–æ–∂–µ Flask —Å—ä—Ä–≤—ä—Ä—ä—Ç –¥–∞ –≤—ä—Ä–≤–∏ –∑–∞–µ–¥–Ω–æ —Å –Ω–µ–≥–æ.
    """
    bot.infinity_polling(skip_pending=True)


if __name__ == "__main__":
    # —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ –±–æ—Ç–∞ –≤ background –Ω–∏—à–∫–∞
    t = threading.Thread(target=run_bot, daemon=True)
    t.start()

    # —Å—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ Flask, –∑–∞ –¥–∞ –≤–∏–∂–¥–∞ Render –æ—Ç–≤–æ—Ä–µ–Ω –ø–æ—Ä—Ç
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)
